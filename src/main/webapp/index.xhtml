<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <f:view contentType="text/html;charset=UTF-8" encoding="UTF-8">
        <h:head>
            <h:outputStylesheet library="css" name="index.css"/>
        </h:head>
        <h:body>
            <h:form id="form">
                <p:growl id="alert"/>

                <p:toolbar class="my-2">
                    <f:facet name="right">
                        <p:commandButton
                            value="Crear"
                            icon="pi pi-plus"
                            styleClass="ui-button-success"
                            update=":dialog:book-creation-form"
                            actionListener="#{bookView.clearNewBook}"
                            oncomplete="PF('bookCreationDialog').show()">
                            <p:resetInput target=":dialog:book-creation-form" />
                        </p:commandButton>
                    </f:facet>
                </p:toolbar>

                <p:dataTable id="dt-books" widgetVar="dtBooks" var="book" value="#{bookView.books}"
                             reflow="true" rowKey="#{product.isbn}" paginator="true" 
                             rows="10" selectionRowMode="add" paginatorPosition="bottom">
                    <f:facet name="header">
                        <p>Inventario de Libros</p>
                    </f:facet>

                    <p:column headerText="Título" sortBy="#{book.title}" filterBy="#{book.title}">
                        <h:outputText value="#{book.title}" />
                    </p:column>
                    <p:column headerText="Autor" sortBy="#{book.author}" filterBy="#{book.author}">
                        <h:outputText value="#{book.author}" />
                    </p:column>
                    <p:column headerText="Género" sortBy="#{book.genre}" filterBy="#{book.genre}">
                        <h:outputText value="#{book.genre}" />
                    </p:column>
                    <p:column headerText="Fecha de publiación" sortBy="#{book.price}" filterBy="#{book.publicationDate}">
                        <h:outputText value="#{book.publicationDate}">
                            <f:convertDateTime pattern="yyyy-MM-dd" type="localDate" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Preico" sortBy="#{book.price}" filterBy="#{book.price}">
                        <h:outputText value="#{book.price}">
                            <f:convertNumber type="currency" currencySymbol="$"/> 
                        </h:outputText>
                    </p:column>
                </p:dataTable>
            </h:form>

            <h:form id="dialog">
                <p:dialog header="Header" showEffect="fade" modal="true" widgetVar="bookCreationDialog" responsive="true">
                    <p:outputPanel id="book-creation-form">
                        <div class="mb-3">
                            <p:outputLabel for="title">Título</p:outputLabel>
                            <p:inputText 
                                id="title" 
                                required="true" 
                                class="w-100" 
                                value="#{bookView.newBook.title}"/>
                        </div>
                        <div class="mb-3">
                            <p:outputLabel for="author">Author</p:outputLabel>
                            <p:inputText 
                                id="author" 
                                required="true" 
                                class="w-100" 
                                value="#{bookView.newBook.author}"/>
                        </div>
                        <div class="mb-3">
                            <p:outputLabel for="genre">Género</p:outputLabel>
                            <p:selectOneRadio id="genre" layout="responsive" columns="2" value="#{bookView.newBook.genre}">
                                <f:selectItem itemLabel="Fiction" itemValue="FICTION" />
                                <f:selectItem itemLabel="Novel" itemValue="NOVEL" />
                                <f:selectItem itemLabel="Mystery" itemValue="MYSTERY" />
                                <f:selectItem itemLabel="Thriller" itemValue="THRILLER" />
                                <f:selectItem itemLabel="Narrative" itemValue="NARRATIVE" />
                            </p:selectOneRadio>
                        </div>
                        <div class="d-grid mb-3">
                            <p:outputLabel for="price" class="d-block">Precio</p:outputLabel>
                            <p:inputNumber 
                                id="price" 
                                symbol="$"
                                minValue="1"
                                required="true"
                                class="d-content"
                                symbolPosition="s"
                                decimalSeparator="."
                                thousandSeparator=","
                                value="#{bookView.newBook.price}"/>
                        </div>
                        <div class="d-grid">
                            <p:outputLabel for="publicationDate">Fecha de publiación</p:outputLabel>
                            <p:datePicker id="publicationDate" class="date-picker" value="#{bookView.newBook.publicationDate}"/>
                        </div>
                    </p:outputPanel>

                    <f:facet name="footer">
                        <p:commandButton 
                            value="Cancelar"
                            icon="pi pi-times"
                            styleClass="ui-button-secondary"
                            onclick="PF('bookCreationDialog').hide()"/>
                        <p:commandButton 
                            value="Guardar" 
                            icon="pi pi-check"
                            update="book-creation-form dt-books" 
                            actionListener="#{bookView.saveBook}"
                            oncomplete="PF('bookCreationDialog').hide()"/>
                    </f:facet>
                </p:dialog>
            </h:form>
        </h:body>
    </f:view>
</html>